<form method="post">
    {% csrf_token %}
    <h3>Select Date Range</h3>
    {{ date_form.as_p }}

    <h3>Select Item</h3>
    {{ item_form.as_p }}

    <div id="details-container">
        <!-- Dynamic fields will be loaded here -->
    </div>

    <button type="submit">Submit Report</button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const itemSelect = document.getElementById('id_item');
        const detailsContainer = document.getElementById('details-container');

        itemSelect.addEventListener('change', function() {
            const itemId = this.value;
            if (itemId) {
                fetch(`/report/item-details/${itemId}/`)  // URL for dynamic details
                    .then(response => response.json())
                    .then(data => {
                        detailsContainer.innerHTML = '';  // Clear previous fields
                        data.fields.forEach(field => {
                            const fieldHtml = `<label>${field.label}</label>
                                                <input type="${field.type}" name="${field.name}" />`;
                            detailsContainer.insertAdjacentHTML('beforeend', fieldHtml);
                        });
                    });
            }
        });
    });
</script>
<p>Debug: Template is loaded</p>
